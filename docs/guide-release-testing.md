# Release Testing

These steps needs to be followed by the release crew as part of the release process, to ensure that new versions published have a good level of stability.

In most cases we should have 2 release crew members running release testing, on two separate machines.

> [!Caution]
> Currently, this flow can only be done on macOS machines.

> [!Important]
> Make sure you have the right access/tokens set up. See [onboarding](./roles-and-responsibilities.md#onboarding-to-release-crew).


## Steps

### Clean up the local state

When testing locally, we want to ensure that we start from a clean slate to avoid caches polluting our testing.

1. Delete `RNTester` and `RNTestProject` from your Android emulator and iOS simulator if leftover from previous test.
2. Remove any temporary files from the `react-native` repo:

   ```bash
    yarn test-e2e-local-clean
   ```

3. Install dependencies:

   ```bash
    yarn install
   ```

### Generating the projects

The local testing for a release consist of running the [test project](https://github.com/facebook/react-native/tree/main/packages/rn-tester) of the react-native repository, `RNTester`, which contains an in-depth list of components implementations, and generating a fresh new project based on the local code, `RNTestProject`, that will simulate accurately how a `react-native init` project will behave.

To generate the the right project with the specific configuration desired, you can use the command

```bash
yarn test-e2e-local [options]
```

Followed by the wanted options:

```bash
  --help          Show help                                            [boolean]
  --version       Show version number                                  [boolean]
  -t, --target      [choices: "RNTester", "RNTestProject"] [default: "RNTester"]
  -p, --platform                    [choices: "iOS", "Android"] [default: "iOS"]
  -h, --hermes                                         [boolean] [default: true]
  -c, --circleciToken                                                   [string]
```

Using the `-c <your-token>` option is recommended, as the script will download the required artifacts from CircleCI, instead of having to build from source reducing the testing time.
There are a couple of extra requirements to make this flow work:
1. the CI must have run at least once in the current branch. We need to download artifacts generated by CircleCI, so we need to have at least one run of the CI.
2. The relevant jobs must have been finished. The required jobs depends on the task you are about to test:
    - if you are testing RNTester on iOS, it has to download Hermes for iOS. So the job that produces it must have finished successfully
    - if you are testing RNTester on Android, it has to download the right APK (JSC or Hermes). So the job that produces the APKs must have finished successfully.
    - if you are testing RNTestProject, it has to download the maven prebuilts and the Hermes engine for iOS. So the jobs that produce those artifacts must have finished successfully.

If any of those prerequisites is not met, the script should output a proper error message.

> [!Warning]
> CI artifacts are only taken from the _last_ commit. This means everytime you push to your release branch, you'll have to wait for the artifacts to build again. You cannot release test using artifacts from an "older" commit. Plan accordingly.

If you need to build React Native from source, you can skip the `-c` parameter. By not passing the CircleCI token, the script falls back to the previous flow, building everything locally.

After completing testing, clean up your local repository state using the following commands.

```sh
yarn test-e2e-local-clean
git reset HEAD --hard
```

## What to test?

Aside from verifying that the building process is successful, once the app spawn by the script is up and running, we want to run a series of manual tests to ensure that some core functionalities work, like Fast Refresh and the Flipper debugger.

In the `RNTester` you want to also play around with the app and try different components: some important onces are `Flatlist`, `Image` and the "New Architecture Component" (should be the very last one in the list).

### Test Dimensions

To ensure that we cover the most use cases, we need to ensure we test all these different combination of configurations:

- RNTester + iOS + Hermes
- RNTester + iOS + JSC
- RNTester + Android + Hermes
- RNTester + Android + JSC
- RNTestProject + iOS + Hermes
- RNTestProject + iOS + JSC
- RNTestProject + Android + Hermes
- RNTestProject + Android + JSC

> [!Note]
> Bear in mind that RNTester project is already onboarded in the new architecture. `RNTestProject` is not - new architecture mode needs to be [enabled](https://github.com/reactwg/react-native-new-architecture/blob/main/docs/enable-apps.md#enable-the-new-architecture-for-apps) and tested separately.

### Test Notes

<details>
<summary>Debugging</summary>

### Basic checks

- **Debugger launch flow**
  - Use Dev Menu > Open Debugger.
  - **0.73 and later**: Use `npx react-native-start --experimental-debugger`. Should connect to Hermes debugger in experimental new debugger frontend.
  - **Pre-0.73**: Should connect to Hermes debugger in Flipper.
- **Console tab**
  - **All versions**: Should display all logs.
- **Sources tab**
  - **All versions**:
    - Should allow viewing of source files (<kbd>Cmd ⌘</kbd> + <kbd>P</kbd> search in Chrome DevTools).
    - Should support setting a breakpoint that is hit during app lifetime. **Note**: Will have broken behaviour across app reloads, excluding via `debugger;` statement.

</details>

## Testing pre-releases (RC) on production apps

During the Release Candidate (RC) phase of a release cycle, we ask for the community to set as dependency in their apps the latest RC available and report in the related "Road to 0.XX" how it performs ([example](https://github.com/reactwg/react-native-releases/discussions/26)).

To help provide the relevant information, we have prepared this template they can use as blueprint for what is important to test - they can copy/pasted it in a comment and fill it accordingly.

```markdown
| Link to branch:                      |                         |
| -----------------------------------  | :---------------------- |
| **Project info**                     |                         |
| Name                                 |                         |
| Starting RN version                  | <add me, ex. RN 0.65.1> |
| Hermes on iOS                        | yes/no                  |
| Hermes on Android                    | yes/no                  |
| **Tested - iOS**                     |                         |
| Fast Refresh                         | ✅/🚨/🙅‍♂️                 |
| Debug/dev build on Simulator         | ✅/🚨/🙅‍♂️                 |
| Debug/dev build on Device            | ✅/🚨/🙅‍♂️                 |
| Production build                     | ✅/🚨/🙅‍♂️                 |
| Debugger (Hermes)                    | ✅/🚨/🙅‍♂️                 |
| Deploy to TestFlight                 | ✅/🚨/🙅‍♂️                 |
| **Tested - Android**                 |                         |
| Fast Refresh                         | ✅/🚨/🙅‍♂️                 |
| Debug/dev build on Emulator          | ✅/🚨/🙅‍♂️                 |
| Debug/dev build on Device            | ✅/🚨/🙅‍♂️                 |
| Production build                     | ✅/🚨/🙅‍♂️                 |
| Debugger (Hermes)                    | ✅/🚨/🙅‍♂️                 |
| **Optional - Deprecated in 0.73**    |                         |
| Chrome remote debugger (Android/iOS) | ✅/🚨/🙅‍♂️                 |
| Flipper debugger (Android/iOS)       | ✅/🚨/🙅‍♂️                 |
```

## Versions older than 71

You need to use the interactive script run you through the different variants in [Test Dimensions](#test-dimensions):

```bash
./scripts/test-manual-e2e.sh
```

This script will ask you to select which platform and which project you want to test, and then to execute a series of extra steps during the process. Bear in mind, when testing RNTester on Android, you need to start the Android emulator ahead of time or it will fail.